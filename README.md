Web Datasets Tagger 1.3
项目概述
Web Datasets Tagger 是一款部署于浏览器环境的图像自动化标注应用程序，其核心目标在于辅助用户为图像数据集高效生成高品质的标签或描述性文本。该工具集成了两种核心功能：一种是基于本地运算的高效Booru风格标签生成机制，另一种则是在线调用强大的自然语言处理模型以生成描述（NL Captions）。此双重能力为图像资料管理、数据集的系统化整理以及内容创作等领域提供了有力的技术支持。

本项目在Booru Tags模式下完全于用户浏览器内部执行运算，而在NL Captions模式中则通过用户提供的API密钥与外部服务进行交互，从而最大限度地保障了用户数据的隐私性与安全性。

核心功能特性
双重标签生成模式:

Booru Tags (本地化处理): 运用ONNX Runtime Web技术栈，在用户本地浏览器环境中执行深度学习模型推断，从而生成以逗号分隔的关键词标签（例如，符合Danbooru等图像库的标签规范）。

内置支持一系列广泛应用的图像标签预设模型（例如WD1.4 Tagger系列、Z3D-E621-Convnext等）。

赋予用户加载自定义.onnx格式模型及对应.csv格式标签文件的能力。

模型与标签文件可选择性地通过Hugging Face Hub（或其官方镜像站点）进行下载。

下载获取的模型资源允许选择永久性缓存于浏览器IndexedDB数据库中，以实现后续调用的快速加载与复用。

NL Captions (在线处理): 经由用户配置的外部视觉语言模型 (VLM) API接口（兼容OpenAI API标准格式，如GPT-4o、Gemini等模型），为输入图像生成符合自然语言习惯的描述性标题或段落。

用户需预先提供有效的API URL、API密钥以及指定的模型名称。

API相关配置参数将被安全地存储于用户浏览器的本地存储空间。

系统内置了API预热及请求重试机制，旨在提升网络连接的稳定性与操作成功率。

灵活的图像输入机制:

支持单张或多张图像文件的即时预览与标签生成。

提供便捷的拖拽方式上传图像文件。

允许用户选择整个文件夹进行批量自动化处理。

参数化定制选项:

Booru Tags模式:

模型输入图像的尺寸可进行调整。

可分别为通用标签与角色特定标签设定独立的置信度阈值。

支持在生成的标签序列的起始或末尾位置添加用户自定义的触发词（可选择是否附加逗号）。

提供对标签中括号字符进行自动转义的功能。

NL Captions模式:

允许用户设定“角色名”作为提示信息，以引导语言模型在生成描述时更侧重于图像中的特定主体。

便捷的输出与保存功能:

预览模式: 处理结果将即时呈现在对应图像的下方区域。

批量处理模式:

Booru Tags模式生成的关键词标签将以.txt文件格式（内容为逗号分隔的字符串）自动保存至原始图像所在的目录。

NL Captions模式生成的描述性文本将以.txt文件格式（内容为纯文本描述）自动保存至原始图像所在的目录。

打包下载: 在预览模式下，所有已生成的有效结果均可以被整合并打包为.zip压缩文件供用户下载。

用户友好的交互界面:

应用程序界面基于Tailwind CSS框架构建，呈现现代化且具备响应式布局的特点。

内置详尽的“帮助与关于”对话框，为用户提供操作指引与背景信息。

提供清晰明确的状态更新提示及处理进度显示。

纯前端架构，注重数据隐私:

Booru Tags模式的所有数据处理均在用户本地浏览器完成，图像数据不会上传至任何服务器。

NL Captions模式下，图像数据会转换为Base64编码格式后，直接发送至用户指定的API端点；本工具自身不执行任何图像数据的存储或中转操作。

操作指南 (快速入门)
启动应用程序:
打开项目根目录下的 index.html 文件（或用户自定义重命名的HTML文件）。为确保应用程序全部功能（特别是文件夹选择等依赖高级浏览器API的特性）的正常运作，强烈建议通过本地HTTP服务器环境运行此HTML文件。例如，可利用Visual Studio Code内置的 "Live Server" 扩展，或在项目目录下通过Python命令行执行 python -m http.server。直接通过 file:/// 协议访问本地文件可能导致部分功能受限。

选择标签生成模式:
于界面左侧边栏顶部的“标签模式”下拉选择器中，依据需求选取“Booru Tags (本地)”或“NL Captions (在线)”模式。

配置选定模式的参数:

若选择 Booru Tags (本地) 模式:

模型来源管理:

预设模型: 从提供的下拉列表中选取一个预设的图像标签模型。

用户可勾选“使用 HF-Mirror 下载”选项，尝试通过Hugging Face镜像站点加速模型文件的下载过程。

用户可勾选“下载后永久保存在本地”选项，以便将模型文件缓存在浏览器中供后续快速调用，避免重复下载。

点击“选择模型后操作”按钮（此按钮文本会根据模型是否已选择及本地是否已有缓存而动态变化，如变为“加载本地副本”或“下载并加载模型”）。

若本地已存在所选模型的缓存副本，将出现“删除本地副本”按钮，用户可点击以清除该模型的本地缓存。

本地模型: 切换至“本地模型”标签页，用户需分别上传自定义的.onnx格式深度学习模型文件及对应的.csv格式标签定义文件。

全局参数设定: 根据具体应用场景和模型特性，调整“模型输入尺寸”、“通用标签阈值”以及“角色标签阈值”。

高级输出设定: 按需配置“添加触发词”功能及其位置，并选择是否启用“转义括号”功能。

若选择 NL Captions (在线) 模式:

在界面左侧的“NL Captions API 设置”区域内，准确填写以下信息：

API URL: 此处必须填写完整且有效的API端点地址，例如 https://api.openai.com/v1/chat/completions 或其他兼容服务提供商所指定的URL。

API Key: 输入用户所持有的有效API访问密钥。

API 模型名称: 指定希望调用的模型具体名称，例如 gpt-4o 或 gemini-1.5-pro-latest 等（务必确保所选模型具备图像理解与描述生成能力）。

API相关参数在填写后会自动存储于用户浏览器的本地存储空间，便于下次打开应用时自动加载。

当所有API参数填写完整后，系统可能会尝试执行一次API的“预热”连接，此举旨在优化后续实际请求的响应速度与成功率。

高级输出设定: （此为可选步骤）用户可通过设定“角色名”来向模型提供特定关注点，以期生成更具相关性的图像描述。

选择待处理的图像或文件夹:

单张/少量图像预览处理: 点击主内容区域的“选择图片 (预览)”按钮，并通过文件选择对话框选取一个或多个图像文件；或者，直接将图像文件拖拽至指定的上传区域。选定的图像预览将即时显示在下方。

批量处理文件夹: 点击主内容区域的“选择文件夹 (批量处理)”按钮，然后在弹出的对话框中选择一个包含待处理图像的文件夹。应用程序将自动扫描并列出该文件夹内的所有合格图像文件。

启动标签生成过程:

当所选模式的配置（模型加载或API参数设置）完成，并且已选定待处理的图像或文件夹后，“开始打标”按钮将自动激活并变为可用状态。点击此按钮即可启动图像标签的自动生成流程。

处理期间，界面会通过进度条及状态文本实时反馈当前的执行进度与状态。

查阅及使用处理结果:

预览模式: 图像处理完毕后，生成的标签或描述文本将直接展示在对应图像的卡片下方。

对于Booru Tags模式，标签将以标签云的形式呈现，并提供“复制标签”按钮，方便用户一键复制所有生成的关键词。

对于NL Captions模式，将直接显示生成的自然语言描述文本，并提供“复制描述”按钮。

在预览模式下，用户可通过点击“打包当前预览结果 (ZIP)”按钮，将所有已处理图像的有效结果整合下载为一个ZIP压缩文件。

批量处理模式:

无论是Booru Tags模式还是NL Captions模式，生成的标签或描述文本都将自动以与原始图像文件同名（扩展名为.txt）的文本文件形式，保存至原始图像所在的文件夹内。

每张图像的处理卡片上会显示相应的保存状态信息。

标签模式特性对比
Booru Tags (本地化处理)
输出形式: 生成由逗号分隔的关键词序列 (例如: 1girl, solo, long hair, red eyes, ...)。

优势:

运算完全在用户本地浏览器环境中进行，下载模型后无需持续网络连接。

处理速度相对较快，具体效能取决于模型规模及用户计算机硬件配置。

图像数据不离开用户本地设备，具有较高的隐私保障。

局限性:

生成的标签通常为预先定义的、离散化的关键词。

对于复杂场景的理解或生成连贯性描述的能力相对有限。

需要用户进行模型文件的管理（包括预设模型的下载或本地自定义模型的上传）。

相关配置参数: 模型来源选择、模型输入图像尺寸、通用标签置信度阈值、角色标签置信度阈值、触发词添加选项、括号转义选项。

NL Captions (在线处理)
输出形式: 生成符合自然语言习惯的图像标题或描述性段落 (例如: "一位拥有棕色长发的年轻女性正对着镜头微笑，她身着蓝色连衣裙，站在阳光明媚的花园中。")。

优势:

能够利用强大的云端视觉语言模型 (VLM) 生成更为自然、详尽且具备上下文感知能力的图像描述。

对于图像中的复杂场景、物体间关系以及情感氛围具有更佳的理解能力。

支持与多种兼容OpenAI API格式的VLM服务提供商进行集成。

内置API预热及请求重试机制，以增强连接的稳定性与请求成功率。

制约因素:

必须保持有效的互联网连接方可使用。

依赖外部API服务，可能产生相应的服务费用（具体取决于API服务提供商的计费策略）。

处理速度受到网络延迟及API服务响应时间的直接影响。

图像数据（以Base64编码形式）将被发送至用户指定的API端点进行处理。

相关配置参数: API URL、API密钥、API模型名称、角色名设定（用于提示）。

技术架构概要
核心业务逻辑: Vanilla JavaScript (ECMAScript 6及以上版本)

本地深度学习推断: ONNX Runtime Web (支持WebGPU及WASM执行后端)

用户界面构建: HTML, Tailwind CSS

文件打包功能: JSZip库

浏览器本地数据存储: IndexedDB (用于缓存预设的ONNX模型), LocalStorage (用于持久化API配置参数)

开源许可证
本项目遵循 AGPL-3.0 license 开源协议进行分发。详细条款请参阅项目根目录下的 LICENSE 文件（若已包含）。

开发者信息
主要贡献者: 西 (GitHub用户ID: violet0927)

项目GitHub仓库: https://github.com/violet0927/Web-Datasets-Tagger

常见问题解答 (FAQ)
问：Booru Tags (本地ONNX) 模式下模型加载缓慢或失败应如何处理？

答：首先，请确保在首次下载预设模型时网络连接通畅。可尝试切换“使用 HF-Mirror 下载”选项以利用镜像站点加速，但更推荐的方式是配置并使用全局代理工具。大型模型在首次加载时耗时较长属于正常现象。若问题持续存在，请检查浏览器开发者工具的控制台（Console）标签页，查找有无相关的错误信息输出，以便进一步定位问题。

问：NL Captions (在线API) 模式下请求失败或无结果返回，应如何排查？

答：首先，务必确认已在“API 设置”区域内输入了正确且完整的API URL（例如 https://api.openai.com/v1/chat/completions）、有效的API密钥以及准确的API模型名称，并确保所选模型具备图像理解能力。其次，检查当前设备的网络连接是否稳定。本工具已内置API预热及最多两次的请求自动重试机制；若经过多次尝试后请求依旧失败，请打开浏览器开发者工具的控制台，查看是否有关于API请求的具体错误日志，这些信息可能包含由API服务器返回的失败原因。最后，请核实所使用的模型名称与API端点是否兼容，以及API密钥是否拥有对该模型的访问权限和足够的调用配额。

问：生成的 Booru Tags 或 NL Captions 结果未达预期，有何优化建议？

答：对于Booru Tags模式，可尝试调整通用标签及角色标签的置信度阈值，更换不同的预设模型，确保输入图像的清晰度，或检查并优化本地自定义模型的标签文件质量。对于NL Captions模式，可以尝试在“高级输出设置”中的“设置角色名”字段提供更具体或不同的引导性提示词，或者选用其他API模型名称进行测试。用户也可考虑在本地修改NL Captions的系统提示词（目前为内置，未来版本可能开放编辑）。不同模型针对不同类型的图像，其表现效果可能存在差异。

问：为何“批量处理文件夹”功能在直接通过 file:/// 协议打开HTML文件时可能无法正常工作？

答：此项功能依赖于现代浏览器提供的File System Access API。出于安全策略的考量，浏览器通常要求调用此类API的页面通过 http:// 或 https:// 协议进行访问（例如，通过本地HTTP服务器部署，访问地址为 http://localhost）。若直接从本地文件系统路径（即 file:///）打开HTML文件，浏览器可能会限制该API的使用权限，从而导致功能异常。

希望这份经过优化的README文档能够满足您的要求。
